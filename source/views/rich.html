<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

       

  
        <!-- include libraries(jQuery, bootstrap) -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
       
        

        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

      </head>
 

 
 
 

   
        <style>
        body{
            max-width: 100vw;
            background-color: rgb(194, 194, 194);
            height: 100vh;
        }
        


        .content-pages{
            display: flex;
            justify-content: center;
            margin: 40px 0;
        }

        .page{
            width: 620px;
            height: 770px;
            background-color: white;
        }

        .page.page-selected{

            border: 1px solid;
            border-color: rgb(139, 139, 255);

        }

        .btn-toolbar{
           justify-content: center;
            padding: 5px;
        }

        .draglabe{
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: absolute;
            border: 2px solid;
            border-color: transparent;
            background-color: transparent;
            resize: none;
            z-index: 9;
        }

        .draglabe.table{
            margin: 0;
            padding: 0;
            width: auto;
            overflow: none;
            position: absolute;
            border: 2px solid;
            border-color: transparent;
            background-color: transparent;
            resize: none;
            z-index: 9;
        }

        .draglabe.table.focus-table{
           border: 2px solid;
           border-color: rgba(139, 139, 255, 0.651);
           border-radius: 3px;

           margin: 0;
            padding: 0;
            width: auto;
            overflow: none;
            position: absolute;
            background-color: transparent;
            resize: none;
            z-index: 9;
        }

        textarea{
            overflow: hidden;
            width: 100%;
            height: 100%;
            resize:none;
            border: none;
            background-color: transparent;
          

        }

        textarea:focus{
            outline: 0;
            background-color: transparent;

        }

        .draglabe.focus{
            overflow: hidden;
            border: 2px solid;
           
            border-color: rgba(139, 139, 255, 0.651);
            border-radius: 3px;
            background-color: transparent;
            resize: both;
           
        }

        input[type="color"] {
        border: none;
        border-radius: 3px;
        padding: 0;
        height: 35px;
        width: 35px;

        -webkit-clip-path: circle(50% at 50% 50%);
            clip-path: circle(50% at 50% 50%);
        }

        input[type="color"]:focus {
        outline: 0;
        }

        input[type="color"]::-moz-color-swatch {
        border: none;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
        border-radius: 0;
        }

        input[type="color"]::-webkit-color-swatch {
        border: none;
        }
       

        .btn.btn-secondary.color{
            margin: 0;
            padding: 0;
            width: 40px;
        }

        

        </style>
        <style>
            table {
               
    border-width: 1px;
    border-style: solid;
    border-color: black;
    border-collapse: collapse;
}
table td {
    
    border-width: 1px;
    border-style: solid;
    border-color: black;
}
table th {
    border-width: 1px;
    border-style: solid;
    border-color: black;
    background-color: green;
}

.focus{
    border: 2px solid;  
    border-color: rgba(139, 139, 255, 0.651);
    border-radius: 3px;
}

.input-table{
    width: 100%;
    margin: 0;
    padding: 0;
    height: 100%;
    border: 2px solid;  
    border-color:transparent;
    border-radius: 3px;
    background-color: transparent;
}
.input-table:focus{
    outline: 0;
    border: 2px solid;  
    border-color: rgba(139, 139, 255, 0.651);
    border-radius: 3px;
}
        </style>
  
</head>
<body>
    
    
  
    <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
        <div class="btn-group me-2" role="group" aria-label="color-group">
           
            <input type="color" id="input-color">
              
        </div>
        <div class="btn-group me-2" role="group" aria-label="tools">
          <button id="btn-paragraph" type="button" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-paragraph" viewBox="0 0 16 16">
                    <path d="M10.5 15a.5.5 0 0 1-.5-.5V2H9v12.5a.5.5 0 0 1-1 0V9H7a4 4 0 1 1 0-8h5.5a.5.5 0 0 1 0 1H11v12.5a.5.5 0 0 1-.5.5"/>
                </svg>
          </button>
          <button type="button" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-image-fill" viewBox="0 0 16 16">
                    <path d="M.002 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2zm1 9v1a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V9.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062zm5-6.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
                </svg>
          </button>
          <div class="dropdown" >
            <button style="border-radius: 0;" type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-table" viewBox="0 0 16 16">
                    <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 2h-4v3h4zm0 4h-4v3h4zm0 4h-4v3h3a1 1 0 0 0 1-1zm-5 3v-3H6v3zm-5 0v-3H1v2a1 1 0 0 0 1 1zm-4-4h4V8H1zm0-4h4V4H1zm5-3v3h4V4zm4 4H6v3h4z"/>
                </svg>
            </button>
            <div class="dropdown-menu p-3 g-3 ">
                <label for="" class="">Colunas</label>
                <input type="number" class="form-control" id="qtd-columns">
                <label for="" class="mt-2">Linhas</label>
                <input type="number" class="form-control" id="qtd-lines">
                <script>
                   
                </script>
                <button class="btn btn-success mt-2" style="width:100%" id="btn-add-table">Criar</button>
            </div>
          </div>
          <button id="btn-trash" type="button" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                    <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5"/>
                </svg>
          </button>
          <button id="btn-print" type="button" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
                <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5"/>
            </svg>
          </button>
        </div>
        
        
      </div>

     

   

      

   

    <div class="content-pages">
        <div class="page" id="print">
        </div>
    </div>


 









<script src="/source/js/rich.js" defer></script>
<script>
   
    
        $(document).ready(()=>{

        function cont(){
        var conteudo = document.getElementById('print').innerHTML;
        tela_impressao = window.open('about:blank');
        tela_impressao.document.write(conteudo);
        tela_impressao.window.print();
        tela_impressao.window.close();
        }

        $('#btn-print').click(()=>{
            cont()
        })





            $('.dropdown-toggle').dropdown({
             
            });

            $('#input-color').focus(function(){
                var val = $(this).val()

                if (val.charAt(0) !== '#') val = '#' + val;
                // expande uma cor desse tamanho: fff
                if (val.length === 4) {
                    var red = val.charAt(1);
                    red += red;
                    var green = val.charAt(2);
                    green += green;
                    var blue = val.charAt(3);
                    blue += blue;

                    val = '#' + red + green + blue;
                }

            })



            ligado = false

            inputTable = false

            $('#btn-add-table').click(()=>{

                let columnsLength = 0
                let linesLength = 0

                linesLength = $('#qtd-lines').val()
                columnsLength = $('#qtd-columns').val()

                if(linesLength == 0 && columnsLength == 0){
                    return
                }
                let htmlGenerateTable = ''

                htmlGenerateTable = '<div class="draglabe table focus-table"><table class="mydiv"><thead><tr>'

                    console.log('oi')

                    

                for(let u = 1; u <= columnsLength; u++)
                {
                
                    htmlGenerateTable += '<th><input class="input-table" style="font-weight: bold;" type="text"></th>'
                }

                htmlGenerateTable += ' </tr></thead><tbody>'

                for(let y = 1; y <= linesLength; y++)
                {
                    htmlGenerateTable += '<tr>'

                        for(let uy = 1; uy <= columnsLength; uy++)
                        {
                            htmlGenerateTable += '  <td><input class="input-table" type="text"></td>'
                        }

                    htmlGenerateTable += '</tr>'
                }
                htmlGenerateTable +=   '</tbody></table></div>'

                console.log('oi')
                $('.page-selected').append(htmlGenerateTable)

                reloadMyDiv()
                reloadMyTable()
                reloadMyInput()

})

function reloadMyInput()
{
    $('input').mousedown(function(){
                inputTable = true
                //this.setSelectionRange(this.value.length, this.value.length)
                $(this).focus()
                
            })


            $('th').mousedown(function(){
                inputTable = false 
            })

            $('input').blur(function(){
                inputTable = false
            })

            $('input').dblclick(function(){ 
                    $(this).select()
                    inputTable = true
            })

}
           
          
           function  reloadMyTable()
           {
            var thElm;
        var startOffset;

        Array.prototype.forEach.call(
        document.querySelectorAll("table th"),
        function (th) {
        th.style.position = 'relative';

        var grip = document.createElement('div');
        grip.innerHTML = "&nbsp;";
        grip.style.top = 0;
        grip.style.right = 0;
        grip.style.bottom = 0;
        grip.style.width = '5px';
        grip.style.position = 'absolute';
        grip.style.cursor = 'col-resize';
        grip.addEventListener('mousedown', function (e) {
            thElm = th;
            startOffset = th.offsetWidth - e.pageX;
            ligado = true
           
        });

        th.appendChild(grip);
      });

    document.addEventListener('mousemove', function (e) {
      if (thElm) {
       
      
        thElm.style.width = startOffset + e.pageX + 'px';
      }
    });

    document.addEventListener('mouseup', function () {
        thElm = undefined;
        ligado = false
       
    });

           }

         



          
            $('.page').addClass('page-selected')

            $('.page').click(function(){
                $(this).addClass('page-selected')
            })

            paragraphCount = 0
            divID= 0

            

            $('body').click(function(e){

              

                if( e.target == $('.content-pages')[0] || e.target == $('.page')[0])
                {
                    removeP()
                    $('.focus').removeClass('focus')
                    $('.focus-table').removeClass('focus-table')
                }
            })

            function removeP()
            {
                var focued = $('.focus')
                if(focued.length > 0)
                {
                    var filho = focued.children()

                    if(filho.val() == '')
                    {
                        focued[0].remove()
                    }

                }
                
                

            }
         
            $('#btn-paragraph').click(()=>{
                $('.page-selected').append('<div id="div-'+divID+'" class="draglabe"><textarea id="paragraph-'+paragraphCount+'" class="mydiv"></textarea></div>')
                


                removeP()

                $('.focus').removeClass('focus')
                $('#div-'+divID+'').addClass('focus')


                $('#paragraph-'+paragraphCount+'').focus()

                $('#paragraph-'+paragraphCount+'').click(function(){

                    $(this).focus()

                    var focued = $('.focus')

                    if(focued.length > 0)
                    {
                        var filho = focued.children()

                        if(filho.val() == '' && focued[0].id != this.parentNode.id)
                        {
                            
                            focued[0].remove()
                        }

                    }

                    

                    var paiNode = this.parentNode;
                    
                    $('.focus').removeClass('focus')
                    
                    $(paiNode).addClass('focus')
                    
                })

              
                reloadMyDiv()
                paragraphCount++
                divID++
              


            })

           

            $('#btn-trash').click(function(){
                $('.focus').remove()
                $('.focus-table').remove()
            })

            


            reloadMyDiv()
            elements = []

            // Make the DIV element draggable:
            function reloadMyDiv(){
                 elements = []
                 elements = document.querySelectorAll(".mydiv");
                
                 elements.forEach(item => {
                        
                        dragElement(item)
                    });
            }
           

            

          

            

        function dragElement(elmnt) {

           

            
        var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
        if (document.getElementById(elmnt.id + "header")) {
            // if present, the header is where you move the DIV from:
            document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
        } else {
            // otherwise, move the DIV from anywhere inside the DIV:
            elmnt.onmousedown = dragMouseDown;
        }

        function dragMouseDown(e) {

           
            if(elmnt.tagName == 'TABLE')
            {
                let divTable = elmnt.parentNode
                
                $(divTable).addClass('focus-table')
            }

           

            if (ligado == true)
            {
                
                return 
            }
            e = e || window.event;
            e.preventDefault();
            // get the mouse cursor position at startup:
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            // call a function whenever the cursor moves:
            document.onmousemove = elementDrag;
        }


        xR = 0
        xL = 0

        yT = 0
        yB = 0

       

        function elementDrag(e) {
            
            if(inputTable == true)
            {
                
                return
            }
            
            


            e = e || window.event;
            e.preventDefault();
            // calculate the new cursor position:

         
            var pai = elmnt.parentNode
            $('.focus').removeClass('focus')
            if(!$(pai).hasClass('focus') && elmnt.tagName == "TEXTAREA"){
                $(pai).addClass('focus')
            } 

          

            /*
            var pai2 = pai.parentNode

            console.log(pai2)

            

            

            xL =  pos3 - pai.getBoundingClientRect().left

            xR = pai.clientWidth - (pos3 - pai.getBoundingClientRect().left) 

            yT = pos4 - pai.getBoundingClientRect().top

            yB =  pai.clientHeight - (pos4 - pai.getBoundingClientRect().top) 
            

            if ( e.clientX  < xL) {
                pai.style.left = 0 + "px";
                    
                } else if (e.clientX + xR  > pai2.clientWidth) {
                    pai.style.left = (pai2.clientWidth - pai.clientWidth) + "px";
                   
                } else {
                    pai.style.left = (pai.offsetLeft - (pos3 - e.clientX)) + "px";
                    
                }
            
            if (e.clientY < yT) {
                pai.style.top = 0 + "px";
            
            } else if (e.clientY + yB > pai2.clientHeight) {
            
                pai.style.top = ( pai2.clientHeight - pai.clientHeight) + "px";
            } else {
                pai.style.top = (pai.offsetTop - (pos4 - e.clientY)) + "px";
            
            }
            */

        pai.style.left = (pai.offsetLeft - (pos3 - e.clientX)) + "px";
        pai.style.top = (pai.offsetTop - (pos4 - e.clientY)) + "px";
        pos3 = e.clientX;
        pos4 = e.clientY;
            // set the element's new position:
        

        }

        function closeDragElement() {
            // stop moving when mouse button is released:
            document.onmouseup = null;
            document.onmousemove = null;
        }
        }
             
                })
         
</script>
</body>
</html>